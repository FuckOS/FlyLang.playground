# This workflow will do a clean install of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: Build

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      name: Checkout Files

    - name: Use Node.js 16.x
      uses: actions/setup-node@v2
      with:
        node-version: 16.x
        cache: 'yarn'

    - run: 'yarn'
      name: Install Project

    - run: 'yarn build:editor'
      name: Build Editor Web Worker

    - run: 'yarn build'
      name: Build Project
      env:
        COMMIT_ID: ${{ github.events.commits[0].id }}
        COMMIT_URL: ${{ github.events.commits[0].url }}

#     - name: Commit files
#       run: |
#         git config --local user.email "github-actions[bot]@users.noreply.github.com"
#         git config --local user.name "github-actions[bot]"
#         mv dist docs
#         git add .
#         git commit -m "Build with commit ${{ github.events.commits[0].id }}@${{ github.events.ref }}" -a
#         git push origin gh-pages
    - name: Github Pages Custom Deploy
     # You may pin to the exact commit or the version.
      # uses: sterlingwes/gh-pages-deploy-action@8b237b6c575f341cd5c28660337a21869e222f62
      uses: sterlingwes/gh-pages-deploy-action@v1.1
      with:
        # A personal access token needed to push your site after it has been built.
        access-token: ${{ secrets.GITHUB_TOKEN }}
        # The subdirectory that your build command outputs your site assets to.
        source-directory: dist # default is 
        # The build command that should be run to generate your site.
        build-command: ls # default is 
        # The branch expected by GitHub to have the static files needed for your site.
        deploy-branch: gh-pages # optional, default is gh-pages
        # The custom domain you want your Github Pages site to be served from.
        custom-domain: play.flyos.top # optional, default is 

